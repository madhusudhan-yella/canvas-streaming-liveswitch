{"version":3,"sources":["../node_modules/fm.liveswitch sync /^/.*$","Call.js","Cloth.js","js/cloth.js","App.js","index.js"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","appId","Call","callId","userId","setClientStatus","setCanvasUpConnectionStatus","setRemoteViews","channel","localMedia","canvasUpConnection","canvasDownConnections","downConnectionTimers","handleClientStateChange","cl","getState","liveswitch","ClientState","New","Registering","Registered","Unregistering","Unregistered","register","Promise","reject","token","Token","generateClientRegisterToken","client","getUserId","getDeviceId","getId","getRoles","ChannelClaim","then","channels","addOnRemoteUpstreamConnectionOpen","handleUpStream","fail","console","error","startLocalMedia","stream","document","getElementById","captureStream","LocalMedia","start","handleUpConnectionStateChange","con","ConnectionState","Initializing","Connecting","Connected","Closing","Closed","Failing","Failed","openConnection","videoStream","VideoStream","createSfuUpstreamConnection","addOnStateChange","open","window","setInterval","getStats","res","log","getMediaStream","getTransport","getBytesSent","getBytesReceived","getUpdatedViews","views","status","view","some","item","handleDownConnectionStateChange","c","remoteMedia","getView","filter","RemoteMedia","downConnection","createSfuDownstreamConnection","this","Client","Cloth","useEffect","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","bounce","canvas","ctx","getContext","width","parentElement","offsetWidth","height","offsetHeight","strokeStyle","mouse","cut","influence","down","button","x","y","px","py","Point","vx","vy","pinX","pinY","constraints","delta","dx","dy","dist","Math","sqrt","addForce","nx","ny","i","length","draw","forEach","constraint","point","push","Constraint","splice","indexOf","pinx","piny","p1","p2","diff","free","mul","moveTo","lineTo","points","startX","clothX","pin","attach","beginPath","update","stroke","setMouse","rect","getBoundingClientRect","clientX","left","clientY","top","onmousedown","which","onmousemove","onmouseup","oncontextmenu","preventDefault","cloth","time","clearRect","createCloth","props","videoRef","useRef","current","style","position","innerHTML","appendChild","ref","App","useState","clientStatus","canvasUpConnectionStatus","remoteviews","callInstance","setCallInstance","isSetUpProgress","setIsSetUpProgress","errorMessage","setErrorMessage","parts","location","pathname","split","shift","newParts","p","callid","userid","call","catch","disabled","onClick","color","className","app","StrictMode","ReactDOM","render"],"mappings":"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","file":"static/js/main.e5244a58.chunk.js","sourcesContent":["var map = {\n\t\"./fm.liveswitch\": 0,\n\t\"./fm.liveswitch.d.ts\": 19,\n\t\"./fm.liveswitch.js\": 0,\n\t\"./package\": 10,\n\t\"./package.json\": 10\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 18;","\r\nimport liveswitch from 'fm.liveswitch';\r\n\r\nconst gatewayUrl = 'https://demo.liveswitch.fm:8443/sync';\r\nconst appId = 'my-app-id';\r\nconst sharedSecret = '--replaceThisWithYourOwnSharedSecret--';\r\n\r\nexport default class Call {\r\n    callId;\r\n    client;\r\n    setClientStatus;\r\n    setCanvasUpConnectionStatus;\r\n    setRemoteViews;\r\n    channel = null;\r\n    localMedia = null;\r\n    canvasUpConnection = null;\r\n    canvasDownConnections = {};\r\n    downConnectionTimers = {};\r\n    constructor(callId, userId, setClientStatus, setCanvasUpConnectionStatus, setRemoteViews) {\r\n        this.callId = callId;\r\n        this.setClientStatus = setClientStatus;\r\n        this.setCanvasUpConnectionStatus = setCanvasUpConnectionStatus;\r\n        this.setRemoteViews = setRemoteViews;\r\n        this.client = new liveswitch.Client(gatewayUrl, appId, userId);\r\n        this.client.addOnStateChange(this.handleClientStateChange);\r\n    }\r\n    handleClientStateChange = cl => {\r\n        if (cl.getState() === liveswitch.ClientState.New) this.setClientStatus('NEW');\r\n        if (cl.getState() === liveswitch.ClientState.Registering) this.setClientStatus('REGISTERING');\r\n        if (cl.getState() === liveswitch.ClientState.Registered) this.setClientStatus('REGISTERED');\r\n        if (cl.getState() === liveswitch.ClientState.Unregistering) this.setClientStatus('UNREGISTERING');\r\n        if (cl.getState() === liveswitch.ClientState.Unregistered) this.setClientStatus('UNREGISTERED');\r\n    }\r\n    register = () => {\r\n        return new Promise((resolve, reject) => {\r\n            const token = liveswitch.Token.generateClientRegisterToken(appId, this.client.getUserId(), this.client.getDeviceId(), this.client.getId(), this.client.getRoles(), [ new liveswitch.ChannelClaim(this.callId) ], sharedSecret);\r\n            this.client.register(token).then(channels => {\r\n                this.channel = channels[0];\r\n                this.channel.addOnRemoteUpstreamConnectionOpen(this.handleUpStream);\r\n                resolve();\r\n            }).fail(e => {\r\n                console.error(e);\r\n                reject();\r\n            });\r\n        });\r\n    }\r\n    startLocalMedia = () => {\r\n        return new Promise((resolve, reject) => {\r\n            const stream = document.getElementById('canvas').captureStream(24);\r\n            this.localMedia = new liveswitch.LocalMedia(false, stream);\r\n            this.localMedia.start().then(() => {\r\n                resolve();\r\n            }).fail(e => {\r\n                console.error(e);\r\n                reject();\r\n            });\r\n        });\r\n    }\r\n    handleUpConnectionStateChange = con => {\r\n        if (con.getState() === liveswitch.ConnectionState.New) this.setCanvasUpConnectionStatus('NEW');\r\n        if (con.getState() === liveswitch.ConnectionState.Initializing) this.setCanvasUpConnectionStatus('INITIALIZING');\r\n        if (con.getState() === liveswitch.ConnectionState.Connecting) this.setCanvasUpConnectionStatus('CONNECTING');\r\n        if (con.getState() === liveswitch.ConnectionState.Connected) this.setCanvasUpConnectionStatus('CONNECTED');\r\n        if (con.getState() === liveswitch.ConnectionState.Closing) this.setCanvasUpConnectionStatus('CLOSING');\r\n        if (con.getState() === liveswitch.ConnectionState.Closed) this.setCanvasUpConnectionStatus('CLOSED');\r\n        if (con.getState() === liveswitch.ConnectionState.Failing) this.setCanvasUpConnectionStatus('FAILING');\r\n        if (con.getState() === liveswitch.ConnectionState.Failed) this.setCanvasUpConnectionStatus('FAILED');\r\n    }\r\n    openConnection = () => {\r\n        const videoStream = new liveswitch.VideoStream(this.localMedia);\r\n        this.canvasUpConnection = this.channel?.createSfuUpstreamConnection(videoStream);\r\n        this.canvasUpConnection.addOnStateChange(this.handleUpConnectionStateChange);\r\n        this.canvasUpConnection?.open();\r\n        window.setInterval(() => {\r\n            this.canvasUpConnection?.getStats().then(res => {\r\n                console.log(res.getMediaStream().getTransport().getBytesSent(), ' --- ', res.getMediaStream().getTransport().getBytesReceived());\r\n            });\r\n        }, 5000);\r\n    }\r\n    getUpdatedViews = (views, id, status, view, userId) => {\r\n        if (views.some(item => item.id === id)) {\r\n            return views.map(item => {\r\n                if (item.id === id) return {...item, status, view: item.view || view};\r\n                return {...item};\r\n            })\r\n        } else {\r\n            return [...views, { id, status, view, userId }];\r\n        }\r\n    }\r\n    handleDownConnectionStateChange = (c, remoteMedia, con) => {\r\n        if (c.getState() === liveswitch.ConnectionState.New) this.setRemoteViews(views => this.getUpdatedViews(views, c.getId(), 'NEW', remoteMedia.getView(), con.getUserId()));\r\n        if (c.getState() === liveswitch.ConnectionState.Initializing) this.setRemoteViews(views => this.getUpdatedViews(views, c.getId(), 'INITIALIZE', remoteMedia.getView(), con.getUserId()));\r\n        if (c.getState() === liveswitch.ConnectionState.Connecting) this.setRemoteViews(views => this.getUpdatedViews(views, c.getId(), 'CONNECTING', remoteMedia.getView(), con.getUserId()));\r\n        if (c.getState() === liveswitch.ConnectionState.Connected) {\r\n            this.setRemoteViews(views => this.getUpdatedViews(views, c.getId(), 'CONNECTED', remoteMedia.getView(), con.getUserId()));\r\n            this.downConnectionTimers[c.getId()] = window.setInterval(() => {\r\n                c.getStats().then(res => {\r\n                    console.log('DOWN ', res.getMediaStream().getTransport().getBytesSent(), ' --- ', res.getMediaStream().getTransport().getBytesReceived());\r\n                });\r\n            }, 5000);\r\n        }\r\n        if (c.getState() === liveswitch.ConnectionState.Closing) this.setRemoteViews(views => this.getUpdatedViews(views, c.getId(), 'CLOSING', remoteMedia.getView(), con.getUserId()));\r\n        if (c.getState() === liveswitch.ConnectionState.Closed) {\r\n            this.setRemoteViews(views => views.filter(item => item.id !== c.getId()));\r\n            delete this.downConnectionTimers[c.getId()];\r\n        }\r\n        if (c.getState() === liveswitch.ConnectionState.Failing) this.setRemoteViews(views => this.getUpdatedViews(views, c.getId(), 'FAILING', remoteMedia.getView(), con.getUserId()));\r\n        if (c.getState() === liveswitch.ConnectionState.Failed) {\r\n            this.setRemoteViews(views => views.filter(item => item.id !== c.getId()));\r\n            delete this.downConnectionTimers[c.getId()];\r\n            this.handleUpStream(con);\r\n        }\r\n    }\r\n    handleUpStream = con => {\r\n        const remoteMedia = new liveswitch.RemoteMedia();\r\n        const videoStream = new liveswitch.VideoStream(remoteMedia);\r\n        const downConnection = this.channel.createSfuDownstreamConnection(con, videoStream);\r\n        downConnection.addOnStateChange(c => this.handleDownConnectionStateChange(c, remoteMedia, con));\r\n        this.canvasDownConnections[downConnection.getId()] = downConnection;\r\n        downConnection.open();\r\n    }\r\n}","import { useEffect } from \"react\";\r\nimport { createCloth } from \"./js/cloth\";\r\n\r\nconst Cloth = () => {\r\n\r\n    useEffect(() => {\r\n        createCloth();\r\n    }, []);\r\n\r\n    return (\r\n        <canvas id='canvas' />\r\n    )\r\n}\r\n\r\nexport default Cloth;","\r\nexport const createCloth = () => {\r\n\r\n    window.requestAnimFrame =\r\n        window.requestAnimationFrame ||\r\n        window.webkitRequestAnimationFrame ||\r\n        window.mozRequestAnimationFrame ||\r\n        window.oRequestAnimationFrame ||\r\n        window.msRequestAnimationFrame ||\r\n        function (callback) {\r\n            window.setTimeout(callback, 1e3 / 60)\r\n        }\r\n\r\n    let accuracy = 5\r\n    let gravity = 400\r\n    let clothY = 28\r\n    let clothX = 54\r\n    let spacing = 8\r\n    let tearDist = 60\r\n    let friction = 0.99\r\n    let bounce = 0.5\r\n\r\n    let canvas = document.getElementById('canvas')\r\n    let ctx = canvas.getContext('2d')\r\n\r\n    canvas.width = canvas.parentElement.offsetWidth\r\n    canvas.height = canvas.parentElement.offsetHeight\r\n\r\n    ctx.strokeStyle = '#555'\r\n\r\n    let mouse = {\r\n        cut: 8,\r\n        influence: 26,\r\n        down: false,\r\n        button: 1,\r\n        x: 0,\r\n        y: 0,\r\n        px: 0,\r\n        py: 0\r\n    }\r\n\r\n    class Point {\r\n        constructor(x, y) {\r\n            this.x = x\r\n            this.y = y\r\n            this.px = x\r\n            this.py = y\r\n            this.vx = 0\r\n            this.vy = 0\r\n            this.pinX = null\r\n            this.pinY = null\r\n\r\n            this.constraints = []\r\n        }\r\n\r\n        update(delta) {\r\n            if (this.pinX && this.pinY) return this\r\n\r\n            if (mouse.down) {\r\n                let dx = this.x - mouse.x\r\n                let dy = this.y - mouse.y\r\n                let dist = Math.sqrt(dx * dx + dy * dy)\r\n\r\n                if (mouse.button === 1 && dist < mouse.influence) {\r\n                    this.px = this.x - (mouse.x - mouse.px)\r\n                    this.py = this.y - (mouse.y - mouse.py)\r\n                } else if (dist < mouse.cut) {\r\n                    this.constraints = []\r\n                }\r\n            }\r\n\r\n            this.addForce(0, gravity)\r\n\r\n            let nx = this.x + (this.x - this.px) * friction + this.vx * delta\r\n            let ny = this.y + (this.y - this.py) * friction + this.vy * delta\r\n\r\n            this.px = this.x\r\n            this.py = this.y\r\n\r\n            this.x = nx\r\n            this.y = ny\r\n\r\n            this.vy = this.vx = 0\r\n\r\n            if (this.x >= canvas.width) {\r\n                this.px = canvas.width + (canvas.width - this.px) * bounce\r\n                this.x = canvas.width\r\n            } else if (this.x <= 0) {\r\n                this.px *= -1 * bounce\r\n                this.x = 0\r\n            }\r\n\r\n            if (this.y >= canvas.height) {\r\n                this.py = canvas.height + (canvas.height - this.py) * bounce\r\n                this.y = canvas.height\r\n            } else if (this.y <= 0) {\r\n                this.py *= -1 * bounce\r\n                this.y = 0\r\n            }\r\n\r\n            return this\r\n        }\r\n\r\n        draw() {\r\n            let i = this.constraints.length\r\n            while (i--) this.constraints[i].draw()\r\n        }\r\n\r\n        resolve() {\r\n            if (this.pinX && this.pinY) {\r\n                this.x = this.pinX\r\n                this.y = this.pinY\r\n                return\r\n            }\r\n\r\n            this.constraints.forEach((constraint) => constraint.resolve())\r\n        }\r\n\r\n        attach(point) {\r\n            this.constraints.push(new Constraint(this, point))\r\n        }\r\n\r\n        free(constraint) {\r\n            this.constraints.splice(this.constraints.indexOf(constraint), 1)\r\n        }\r\n\r\n        addForce(x, y) {\r\n            this.vx += x\r\n            this.vy += y\r\n        }\r\n\r\n        pin(pinx, piny) {\r\n            this.pinX = pinx\r\n            this.pinY = piny\r\n        }\r\n    }\r\n\r\n    class Constraint {\r\n        constructor(p1, p2) {\r\n            this.p1 = p1\r\n            this.p2 = p2\r\n            this.length = spacing\r\n        }\r\n\r\n        resolve() {\r\n            let dx = this.p1.x - this.p2.x\r\n            let dy = this.p1.y - this.p2.y\r\n            let dist = Math.sqrt(dx * dx + dy * dy)\r\n\r\n            if (dist < this.length) return\r\n\r\n            let diff = (this.length - dist) / dist\r\n\r\n            if (dist > tearDist) this.p1.free(this)\r\n\r\n            let mul = diff * 0.5 * (1 - this.length / dist)\r\n\r\n            let px = dx * mul\r\n            let py = dy * mul\r\n\r\n            !this.p1.pinX && (this.p1.x += px)\r\n            !this.p1.pinY && (this.p1.y += py)\r\n            !this.p2.pinX && (this.p2.x -= px)\r\n            !this.p2.pinY && (this.p2.y -= py)\r\n\r\n            return this\r\n        }\r\n\r\n        draw() {\r\n            ctx.moveTo(this.p1.x, this.p1.y)\r\n            ctx.lineTo(this.p2.x, this.p2.y)\r\n        }\r\n    }\r\n\r\n    class Cloth {\r\n        constructor() {\r\n            this.points = []\r\n\r\n            let startX = canvas.width / 2 - clothX * spacing / 2\r\n\r\n            for (let y = 0; y <= clothY; y++) {\r\n                for (let x = 0; x <= clothX; x++) {\r\n                    let point = new Point(startX + x * spacing, 20 + y * spacing)\r\n                    y === 0 && point.pin(point.x, point.y)\r\n                    x !== 0 && point.attach(this.points[this.points.length - 1])\r\n                    y !== 0 && point.attach(this.points[x + (y - 1) * (clothX + 1)])\r\n\r\n                    this.points.push(point)\r\n                }\r\n            }\r\n        }\r\n\r\n        update(delta) {\r\n            let i = accuracy\r\n\r\n            while (i--) {\r\n                this.points.forEach((point) => {\r\n                    point.resolve()\r\n                })\r\n            }\r\n\r\n            ctx.beginPath()\r\n            this.points.forEach((point) => {\r\n                point.update(delta * delta).draw()\r\n            })\r\n            ctx.stroke()\r\n        }\r\n    }\r\n\r\n    function setMouse(e) {\r\n        let rect = canvas.getBoundingClientRect()\r\n        mouse.px = mouse.x\r\n        mouse.py = mouse.y\r\n        mouse.x = e.clientX - rect.left\r\n        mouse.y = e.clientY - rect.top\r\n    }\r\n\r\n    canvas.onmousedown = (e) => {\r\n        mouse.button = e.which\r\n        mouse.down = true\r\n        setMouse(e)\r\n    }\r\n\r\n    canvas.onmousemove = setMouse\r\n\r\n    canvas.onmouseup = () => (mouse.down = false)\r\n\r\n    canvas.oncontextmenu = (e) => e.preventDefault()\r\n\r\n    let cloth = new Cloth()\r\n\r\n        ; (function update(time) {\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n\r\n            cloth.update(0.016)\r\n\r\n            window.requestAnimFrame(update)\r\n        })(0)\r\n\r\n}","import { useEffect, useRef, useState } from \"react\";\nimport Call from \"./Call\";\nimport Cloth from \"./Cloth\";\n\nconst VideoStream = props => {\n    const videoRef = useRef();\n    useEffect(() => {\n        if (props.view && videoRef.current) {\n            props.view.style.width = '100%';\n            props.view.style.height = '100%';\n            props.view.style.position = 'relative';\n            props.view.style['object-fit'] = 'contain';\n            videoRef.current.innerHTML = '';\n            videoRef.current.appendChild(props.view);\n        }\n    }, [props.view]);\n    return (\n        <div style={{width: '100%', height: '100%'}} ref={videoRef} />\n    )\n}\n\nconst App = () => {\n\n    const [ clientStatus, setClientStatus ] = useState(null);\n    const [ canvasUpConnectionStatus, setCanvasUpConnectionStatus ] = useState(null);\n    const [ remoteviews, setRemoteViews ] = useState([]);\n    \n    const [callInstance, setCallInstance] = useState(false);\n\n    const [isSetUpProgress, setIsSetUpProgress] = useState(false);\n    const [errorMessage, setErrorMessage] = useState('');\n\n    useEffect(() => {\n        const pathname = window.location.pathname;\n        const parts = pathname.split('/');\n        parts.shift();\n        const newParts = parts.filter(p => !!p);\n        if (newParts.length !== 2) {\n            setErrorMessage('Your url is not correct, it should be https://test.com/callid/userid. Please reload the page with correct route params');\n            return;\n        }\n        const [ callid, userid ] = newParts;\n        const call = new Call(callid, userid, setClientStatus, setCanvasUpConnectionStatus, setRemoteViews);\n        setIsSetUpProgress(true);\n        call.register().then(() => {\n            call.startLocalMedia().then(() => {\n                setCallInstance(call);\n                setIsSetUpProgress(false);\n            }).catch(() => {\n                setErrorMessage('start local media failed, reload to retry');\n            });\n        }).catch(() => {\n            setErrorMessage('registration failed, reload to retry');\n        });\n    }, []);\n\n    const handleClick = () => {\n        setErrorMessage('you can only send stream once')\n        callInstance.openConnection();\n    }\n\n    return (\n        <div>\n            <div>Client Status: {clientStatus}</div>\n            <div>Up Connection Status: {canvasUpConnectionStatus}</div>\n            <button disabled={isSetUpProgress || errorMessage} onClick={handleClick}>SEND Stream</button>\n            { errorMessage && <span style={{color: 'red'}}>{errorMessage}</span> }\n            <div className='app-container'>\n                <div className='canvas-container'>\n                    <Cloth />\n                </div>\n                <div className='remote-views'>\n                    {remoteviews.map(item => {\n                        console.log(item)\n                        return ( \n                            <div className='remote-view-item' key={item.id}>\n                                <div>{item.userId}</div>\n                                <div>{item.status}</div>\n                                {item.view && <VideoStream view={item.view} />}\n                            </div>    \n                        )\n                    })}\n                </div>\n            </div>\n        </div>\n    )\n}\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport './index.css';\n\nconst app = (\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>\n);\n\nReactDOM.render(app, document.getElementById('root'));"],"sourceRoot":""}